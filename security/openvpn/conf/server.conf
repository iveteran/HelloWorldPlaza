# Sample(Debian): /usr/share/doc/openvpn/examples/sample-config-files/server.conf

#port 1199
port 1194
proto tcp
dev tun

# 相关证书配置路径, 由easy-rsa生成
ca /etc/openvpn/server/ca.crt
cert /etc/openvpn/server/server.crt
key /etc/openvpn/server/server.key
dh /etc/openvpn/server/dh.pem

# TLS安全增强，Generated by 'openvpn --genkey secert ta.key'
tls-auth /etc/openvpn/server/ta.key 0     # 0: server side, 1: client side

# 客户端证书撤销验证，Generated by './easyrsa gen-crl'
crl-verify /etc/openvpn/server/crl.pem

server 10.10.0.0 255.255.255.0    # 虚拟网段

client-to-client    # 客户端互通
keepalive 10 120
max-clients 100

#comp-lzo
#allow-compression yes
#compress lz4-v2
#push "compress lz4-v2"

#user openvpn
#group openvpn
user nobody
group nogroup

cipher AES-256-GCM
persist-key
persist-tun

status /var/log/openvpn/openvpn-status.log  # 状态日志路径
log-append /var/log/openvpn/openvpn.log     # 运行日志
verb 3                          # 调试信息级别

# 固定IP分配配置目录
# $ sudo tree /etc/openvpn/server/ccd
# /etc/openvpn/server/ccd
# └── mwx001
#
# $ sudo cat /etc/openvpn/server/ccd/mwx001
# ifconfig-push 10.10.0.10 10.10.0.11
client-config-dir /etc/openvpn/server/ccd

script-security 2

# 密码验证脚本, 密码文件位置见checkpwd.sh中的变量, 密码文件格式：
# USERNAME1 PASSWORD1
# USERNAME2 PASSWORD2
auth-user-pass-verify /etc/openvpn/server/checkpwd.sh via-file
#username-as-common-name    # 用户名作为客户端证书的common name

# 不验证客户端证书，配合auth-user-pass-verify使用只验证用户名和密码
# 客户端使用auth-user-pass <PWD-FILE> 提供用户名和密码
#verify-client-cert none

# Push Google DNS to prevent leak
#push "dhcp-option DNS 8.8.8.8"
#push "dhcp-option DNS 1.1.1.1"

management localhost 7505  # 管理的接口，use telnet to login

# client-connect /etc/openvpn/server/scripts/connect.sh           # 新连接连接时执行脚本
# client-disconnect /etc/openvpn/server/scripts/disconnect.sh     # 有连接退出时执行脚本

